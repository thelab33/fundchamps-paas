{% extends 'base.html' %}
{# ===================== FundChamps Enhanced Stats (SaaS-Ready) ===================== #}
<section id="fundchamps-stats" class="connect-stats relative overflow-visible" role="region"  tabindex="-1">
  <h2 id="fundchamps-stats-heading" class="sr-only">Program Stats</h2>
  <div class="stats-grid">
    {% set stats_defaults = { 'players': 16, 'honor_roll': 11, 'tournaments': 12, 'years': 3 } %}

    {% for key, label in { 'players': 'Players Enrolled', 'honor_roll': 'Honor Roll Scholars', 'tournaments': 'Tournaments Played', 'years': 'Years Running' }.items() %}
      <div class="stat-card" tabindex="0" >
        <span class="stat-confetti" style="opacity: 0;">ğŸ‰</span>
        <span class="counter" data-target="{{ stats[key] if stats is defined and stats[key] is defined else stats_defaults[key] }}">0</span>
        <div class="label">{{ label }}</div>
        <!-- (Optional) Info icon, SaaS style -->
        <span class="info" tabindex="0" role="button"  title="How is this stat tracked?" onclick="alert('This stat is updated after every season &amp; verified by the coaches.')" style="display: none">â„¹ï¸</span>
      </div>
    {% endfor %}
  </div>

  <!-- Example: Call-to-action after stats -->
  <div class="mt-10 text-center text-yellow-300/90 font-semibold text-lg">
    <span>ğŸ† Our stats are real â€” and growing.</span>
    <a href="#tiers" class="underline hover:text-yellow-100 transition">Sponsor the next milestone â†’</a>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const counters = document.querySelectorAll(".counter");
      let confettiFired = false;

      const animateCounters = () => {
        counters.forEach((el) => {
          const target = +el.dataset.target;
          let count = 0;
          const increment = Math.max(1, Math.ceil(target / 68));

          function step() {
            count += increment;
            if (count >= target) {
              el.textContent = target;
              if (!confettiFired) {
                // ğŸ‰ Show confetti on the first stat card only
                const confetti = el.closest(".stat-card").querySelector(".stat-confetti");
                if (confetti) {
                  confetti.style.opacity = 1;
                  confetti.textContent = "ğŸ‰âœ¨";
                  setTimeout(() => (confetti.style.opacity = 0), 1400);
                }
                confettiFired = true;
              }
            } else {
              el.textContent = count;
              requestAnimationFrame(step);
            }
          }
          requestAnimationFrame(step);
        });
      };

      const observer = new IntersectionObserver((entries, obs) => {
        if (entries[0].isIntersecting) {
          animateCounters();
          obs.disconnect();
        }
      }, { threshold: 0.29 });

      observer.observe(document.getElementById("fundchamps-stats"));
    });
  </script>
</section>

